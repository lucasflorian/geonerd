{"version":3,"sources":["app.js","capital-nerd-classic.js","capital-nerd-hard.js","country-nerd.js","flag-nerd-classic.js","flag-nerd-hard.js","navigation.js","settings.js","string-utils.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["class GeoNerdApp {\n\tconstructor(props) {\n\t\tdocument.addEventListener(\"DOMContentLoaded\", () => {\n\t\t\tthis.countries = [];\n\t\t\tthis.countriesByLetter = {};\n\t\t\tthis.letters = [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"y\", \"z\"];\n\t\t\tthis.loadCountries(() => {\n\t\t\t\tnew GeoNerdNavigation();\n\t\t\t\tthis.capitalNerdClassic = new CapitalNerdClassic();\n\t\t\t\tthis.capitalNerdHard = new CapitalNerdHard();\n\t\t\t\tthis.countryNerd = new CountryNerd();\n\t\t\t\tthis.flagNerdClassic = new FlagNerdClassic();\n\t\t\t\tthis.flagNerdHard = new FlagNerdHard();\n\t\t\t});\n\t\t\tnew Settings();\n\t\t});\n\t}\n\n\tloadCountries(callback) {\n\t\tconst request = new XMLHttpRequest();\n\t\trequest.overrideMimeType(\"application/json\");\n\t\trequest.open('GET', '/data/countries-fr.json', true);\n\t\trequest.onreadystatechange = () => {\n\t\t\tif (request.readyState === 4 && request.status === 200) {\n\t\t\t\tJSON.parse(request.responseText).forEach(country => {\n\t\t\t\t\tconst letter = StringUtils.sanitize(country.name.substr(0, 1));\n\t\t\t\t\tif (!this.countriesByLetter[letter]) {\n\t\t\t\t\t\tthis.countriesByLetter[letter] = [];\n\t\t\t\t\t}\n\t\t\t\t\tthis.countriesByLetter[letter].push({\n\t\t\t\t\t\tsanitize: StringUtils.sanitize(country.name),\n\t\t\t\t\t\tname: country.name,\n\t\t\t\t\t\tcode: country.code,\n\t\t\t\t\t\tcapital: country.capital\n\t\t\t\t\t});\n\t\t\t\t\tthis.countries.push({\n\t\t\t\t\t\tsanitize: StringUtils.sanitize(country.name),\n\t\t\t\t\t\tname: country.name,\n\t\t\t\t\t\tcode: country.code,\n\t\t\t\t\t\tcapital: country.capital\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tcallback();\n\t\t\t}\n\t\t};\n\t\trequest.send(null);\n\t}\n\n}\n\nconst geoNerdApp = new GeoNerdApp();\n","class CapitalNerdClassic {\n\tconstructor() {\n\t\tthis.flagContainer = document.querySelector(\".capital-nerd-classic .flag-container\");\n\t\tthis.answerContainer = document.querySelector(\".capital-nerd-classic .answer-container\");\n\t\tthis.winMessage = document.querySelector(\".capital-nerd-classic .win-message\");\n\t\tthis.looseMessage = document.querySelector(\".capital-nerd-classic .loose-message\");\n\t\tthis.lifes = parseInt(localStorage.getItem(\"capitalnerd.lifes\")) || 3;\n\t\tthis.life3 = document.querySelector(\".capital-nerd-classic .heart-3\");\n\t\tthis.life2 = document.querySelector(\".capital-nerd-classic .heart-2\");\n\t\tthis.life1 = document.querySelector(\".capital-nerd-classic .heart-1\");\n\t\tthis.countriesLeft = JSON.parse(localStorage.getItem(\"capitalnerd.countriesleft\"));\n\t\tif (this.countriesLeft) {\n\t\t\tif (this.countriesLeft.length === 0) {\n\t\t\t\tthis.winMessage.classList.add(\"show\");\n\t\t\t\tthis.updateProgress();\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.countriesLeft = [];\n\t\t\tgeoNerdApp.countries.forEach(country => {\n\t\t\t\tthis.countriesLeft.push(country);\n\t\t\t});\n\t\t}\n\t\tthis.updateStorage();\n\t\tthis.updateLife();\n\t}\n\n\tguessFlag() {\n\t\tthis.updateStorage();\n\t\tthis.updateProgress();\n\t\tif (this.countriesLeft.length === 0) {\n\t\t\tthis.winMessage.classList.add(\"show\");\n\t\t\tlocalStorage.setItem(\"capitalnerd.best\", geoNerdApp.countries.length.toString());\n\t\t} else {\n\t\t\tthis.rightAnswer = this.countriesLeft[Math.floor(Math.random() * this.countriesLeft.length)];\n\t\t\tconst proposals = [];\n\t\t\tgeoNerdApp.countries.forEach(country => {\n\t\t\t\tif (country.code === this.rightAnswer.code) {\n\t\t\t\t\tproposals.push({\"code\": country.code, \"name\": country.name, \"capital\": country.capital});\n\t\t\t\t\tthis.toDataURL(`/img/flags/${country.code}.svg`, (dataUrl) => {\n\t\t\t\t\t\tthis.flagContainer.insertAdjacentHTML(\"afterbegin\", `<div class=\"name\" >${country.name}</div>`);\n\t\t\t\t\t\tthis.flagContainer.insertAdjacentHTML(\"afterbegin\", `<div class=\"flag\" style=\"background-image: url(${dataUrl})\"></div>`);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst maxLength = this.countriesLeft.length < 4 ? this.countriesLeft.length : 4;\n\t\t\twhile (proposals.length < maxLength) {\n\t\t\t\tconst proposal = this.countriesLeft[Math.floor(Math.random() * this.countriesLeft.length)];\n\t\t\t\tif (proposal.code !== this.rightAnswer.code) {\n\t\t\t\t\tlet duplicate = false;\n\t\t\t\t\tfor (let prop of proposals) {\n\t\t\t\t\t\tif (prop.code === proposal.code) {\n\t\t\t\t\t\t\tduplicate = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!duplicate) {\n\t\t\t\t\t\tproposals.push({\"code\": proposal.code, \"name\": proposal.name, \"capital\": proposal.capital});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.shuffle(proposals);\n\t\t\tproposals.forEach(proposal => {\n\t\t\t\tthis.answerContainer.insertAdjacentHTML(\"beforeend\", `<div class=\"country\" data-country-code=\"${proposal.code}\">${proposal.capital}</div>`);\n\t\t\t});\n\t\t\tthis.guess();\n\t\t}\n\t}\n\n\tshuffle(array) {\n\t\tlet currentIndex = array.length, randomIndex;\n\t\twhile (currentIndex !== 0) {\n\t\t\trandomIndex = Math.floor(Math.random() * currentIndex);\n\t\t\tcurrentIndex--;\n\t\t\t[array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];\n\t\t}\n\t\treturn array;\n\t}\n\n\tguess() {\n\t\tthis.answerContainer.style.pointerEvents = \"initial\";\n\t\tdocument.querySelectorAll(\".capital-nerd-classic .country\").forEach(guess => {\n\t\t\tguess.addEventListener(\"click\", () => {\n\t\t\t\tlet decreaseLife = false;\n\t\t\t\tif (guess.dataset.countryCode === this.rightAnswer.code) {\n\t\t\t\t\tguess.classList.add(\"valid\");\n\t\t\t\t\tthis.countriesLeft = this.countriesLeft.filter(elem => elem.code !== this.rightAnswer.code);\n\t\t\t\t\tthis.updateStorage();\n\t\t\t\t} else {\n\t\t\t\t\tdocument.querySelector(`[data-country-code=\"${this.rightAnswer.code}\"]`).classList.add(\"valid\");\n\t\t\t\t\tguess.classList.add(\"invalid\");\n\t\t\t\t\tdecreaseLife = true;\n\t\t\t\t}\n\t\t\t\tthis.answerContainer.style.pointerEvents = \"none\";\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tgsap.to(this.flagContainer, {\n\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t});\n\t\t\t\t\tgsap.to(this.answerContainer, {\n\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t\tonComplete: () => {\n\t\t\t\t\t\t\tthis.updateLife(decreaseLife);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}, 700);\n\t\t\t});\n\t\t});\n\t}\n\n\tupdateStorage() {\n\t\tlocalStorage.setItem(\"capitalnerd.countriesleft\", JSON.stringify(this.countriesLeft));\n\t}\n\n\tupdateProgress() {\n\t\tdocument.querySelector(\".capital-nerd-classic .progress .found\").innerHTML = (geoNerdApp.countries.length - this.countriesLeft.length).toString();\n\t\tdocument.querySelector(\".capital-nerd-classic .progress .best .value\").innerHTML = localStorage.getItem(\"capitalnerd.best\") || 0;\n\t}\n\n\tupdateLife(decrease) {\n\t\tif (decrease) {\n\t\t\tthis.lifes--;\n\t\t}\n\t\tif (this.lifes === 0) {\n\t\t\tthis.life1.classList.add(\"loose\");\n\t\t\tthis.life2.classList.add(\"loose\");\n\t\t\tthis.life3.classList.add(\"loose\");\n\t\t\tlocalStorage.removeItem(\"capitalnerd.countriesleft\");\n\t\t\tlocalStorage.removeItem(\"capitalnerd.lifes\");\n\t\t\tconst currentBest = localStorage.getItem(\"capitalnerd.best\") || 0;\n\t\t\tconst currentScore = geoNerdApp.countries.length - this.countriesLeft.length;\n\t\t\tif (currentScore > currentBest) {\n\t\t\t\tlocalStorage.setItem(\"capitalnerd.best\", currentScore.toString());\n\t\t\t}\n\t\t\tgsap.to(this.flagContainer, {\n\t\t\t\topacity: 0,\n\t\t\t});\n\t\t\tgsap.to(this.answerContainer, {\n\t\t\t\topacity: 0,\n\t\t\t\tonComplete: () => {\n\t\t\t\t\tthis.looseMessage.classList.add(\"show\");\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\n\t\t\tthis.flagContainer.innerHTML = \"\";\n\t\t\tthis.flagContainer.style.opacity = \"1\";\n\n\t\t\tthis.answerContainer.innerHTML = \"\";\n\t\t\tthis.answerContainer.style.opacity = \"1\";\n\n\t\t\tswitch (this.lifes) {\n\t\t\t\tcase 3:\n\t\t\t\t\tthis.life1.classList.remove(\"loose\");\n\t\t\t\t\tthis.life2.classList.remove(\"loose\");\n\t\t\t\t\tthis.life3.classList.remove(\"loose\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tthis.life1.classList.remove(\"loose\");\n\t\t\t\t\tthis.life2.classList.remove(\"loose\");\n\t\t\t\t\tthis.life3.classList.add(\"loose\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tthis.life1.classList.remove(\"loose\");\n\t\t\t\t\tthis.life2.classList.add(\"loose\");\n\t\t\t\t\tthis.life3.classList.add(\"loose\");\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.guessFlag();\n\t\t\tlocalStorage.setItem(\"capitalnerd.lifes\", this.lifes);\n\t\t}\n\t\tthis.updateProgress();\n\t}\n\n\ttoDataURL(url, callback) {\n\t\tconst xhr = new XMLHttpRequest();\n\t\txhr.onload = () => {\n\t\t\tconst reader = new FileReader();\n\t\t\treader.onloadend = () => {\n\t\t\t\tcallback(reader.result);\n\t\t\t};\n\t\t\treader.readAsDataURL(xhr.response);\n\t\t};\n\t\txhr.open(\"GET\", url);\n\t\txhr.responseType = \"blob\";\n\t\txhr.send();\n\t}\n}\n","class CapitalNerdHard {\n\tconstructor() {\n\t\tthis.flagContainer = document.querySelector(\".capital-nerd-hard .flag-container\");\n\t\tthis.answerContainer = document.querySelector(\".capital-nerd-hard .answer-container\");\n\t\tthis.winMessage = document.querySelector(\".capital-nerd-hard .win-message\");\n\t\tthis.looseMessage = document.querySelector(\".capital-nerd-hard .loose-message\");\n\t\tthis.lifes = parseInt(localStorage.getItem(\"capitalnerdhard.lifes\")) || 3;\n\t\tthis.life3 = document.querySelector(\".capital-nerd-hard .heart-3\");\n\t\tthis.life2 = document.querySelector(\".capital-nerd-hard .heart-2\");\n\t\tthis.life1 = document.querySelector(\".capital-nerd-hard .heart-1\");\n\t\tthis.countriesLeft = JSON.parse(localStorage.getItem(\"capitalnerdhard.countriesleft\"));\n\t\tif (this.countriesLeft) {\n\t\t\tif (this.countriesLeft.length === 0) {\n\t\t\t\tthis.winMessage.classList.add(\"show\");\n\t\t\t\tthis.updateProgress();\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.countriesLeft = [];\n\t\t\tgeoNerdApp.countries.forEach(country => {\n\t\t\t\tthis.countriesLeft.push(country);\n\t\t\t});\n\t\t}\n\t\tthis.updateStorage();\n\t\tthis.updateLife();\n\t}\n\n\tguessFlag() {\n\t\tthis.updateStorage();\n\t\tthis.updateProgress();\n\t\tif (this.countriesLeft.length === 0) {\n\t\t\tthis.winMessage.classList.add(\"show\");\n\t\t\tlocalStorage.setItem(\"capitalnerdhard.best\", geoNerdApp.countries.length.toString());\n\t\t} else {\n\t\t\tthis.rightAnswer = this.countriesLeft[Math.floor(Math.random() * this.countriesLeft.length)];\n\t\t\tconst proposals = [];\n\t\t\tgeoNerdApp.countries.forEach(country => {\n\t\t\t\tif (country.code === this.rightAnswer.code) {\n\t\t\t\t\tproposals.push({\"code\": country.code, \"name\": country.name, \"capital\": country.capital});\n\t\t\t\t\tthis.toDataURL(`/img/flags/${country.code}.svg`, (dataUrl) => {\n\t\t\t\t\t\tthis.flagContainer.insertAdjacentHTML(\"afterbegin\", `<div class=\"flag\" style=\"background-image: url(${dataUrl})\"></div>`);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst maxLength = this.countriesLeft.length < 4 ? this.countriesLeft.length : 4;\n\t\t\twhile (proposals.length < maxLength) {\n\t\t\t\tconst proposal = this.countriesLeft[Math.floor(Math.random() * this.countriesLeft.length)];\n\t\t\t\tif (proposal.code !== this.rightAnswer.code) {\n\t\t\t\t\tlet duplicate = false;\n\t\t\t\t\tfor (let prop of proposals) {\n\t\t\t\t\t\tif (prop.code === proposal.code) {\n\t\t\t\t\t\t\tduplicate = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!duplicate) {\n\t\t\t\t\t\tproposals.push({\"code\": proposal.code, \"name\": proposal.name, \"capital\": proposal.capital});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.shuffle(proposals);\n\t\t\tproposals.forEach(proposal => {\n\t\t\t\tthis.answerContainer.insertAdjacentHTML(\"beforeend\", `<div class=\"country\" data-country-code=\"${proposal.code}\">${proposal.capital}</div>`);\n\t\t\t});\n\t\t\tthis.guess();\n\t\t}\n\t}\n\n\tshuffle(array) {\n\t\tlet currentIndex = array.length, randomIndex;\n\t\twhile (currentIndex !== 0) {\n\t\t\trandomIndex = Math.floor(Math.random() * currentIndex);\n\t\t\tcurrentIndex--;\n\t\t\t[array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];\n\t\t}\n\t\treturn array;\n\t}\n\n\tguess() {\n\t\tthis.answerContainer.style.pointerEvents = \"initial\";\n\t\tdocument.querySelectorAll(\".capital-nerd-hard .country\").forEach(guess => {\n\t\t\tguess.addEventListener(\"click\", () => {\n\t\t\t\tlet decreaseLife = false;\n\t\t\t\tif (guess.dataset.countryCode === this.rightAnswer.code) {\n\t\t\t\t\tguess.classList.add(\"valid\");\n\t\t\t\t\tthis.countriesLeft = this.countriesLeft.filter(elem => elem.code !== this.rightAnswer.code);\n\t\t\t\t\tthis.updateStorage();\n\t\t\t\t} else {\n\t\t\t\t\tdocument.querySelector(`[data-country-code=\"${this.rightAnswer.code}\"]`).classList.add(\"valid\");\n\t\t\t\t\tguess.classList.add(\"invalid\");\n\t\t\t\t\tdecreaseLife = true;\n\t\t\t\t}\n\t\t\t\tthis.answerContainer.style.pointerEvents = \"none\";\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tgsap.to(this.flagContainer, {\n\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t});\n\t\t\t\t\tgsap.to(this.answerContainer, {\n\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t\tonComplete: () => {\n\t\t\t\t\t\t\tthis.updateLife(decreaseLife);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}, 700);\n\t\t\t});\n\t\t});\n\t}\n\n\tupdateStorage() {\n\t\tlocalStorage.setItem(\"capitalnerdhard.countriesleft\", JSON.stringify(this.countriesLeft));\n\t}\n\n\tupdateProgress() {\n\t\tdocument.querySelector(\".capital-nerd-hard .progress .found\").innerHTML = (geoNerdApp.countries.length - this.countriesLeft.length).toString();\n\t\tdocument.querySelector(\".capital-nerd-hard .progress .best .value\").innerHTML = localStorage.getItem(\"capitalnerdhard.best\") || 0;\n\t}\n\n\tupdateLife(decrease) {\n\t\tif (decrease) {\n\t\t\tthis.lifes--;\n\t\t}\n\t\tif (this.lifes === 0) {\n\t\t\tthis.life1.classList.add(\"loose\");\n\t\t\tthis.life2.classList.add(\"loose\");\n\t\t\tthis.life3.classList.add(\"loose\");\n\t\t\tlocalStorage.removeItem(\"capitalnerdhard.countriesleft\");\n\t\t\tlocalStorage.removeItem(\"capitalnerdhard.lifes\");\n\t\t\tconst currentBest = localStorage.getItem(\"capitalnerdhard.best\") || 0;\n\t\t\tconst currentScore = geoNerdApp.countries.length - this.countriesLeft.length;\n\t\t\tif (currentScore > currentBest) {\n\t\t\t\tlocalStorage.setItem(\"capitalnerdhard.best\", currentScore.toString());\n\t\t\t}\n\t\t\tgsap.to(this.flagContainer, {\n\t\t\t\topacity: 0,\n\t\t\t});\n\t\t\tgsap.to(this.answerContainer, {\n\t\t\t\topacity: 0,\n\t\t\t\tonComplete: () => {\n\t\t\t\t\tthis.looseMessage.classList.add(\"show\");\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\n\t\t\tthis.flagContainer.innerHTML = \"\";\n\t\t\tthis.flagContainer.style.opacity = \"1\";\n\n\t\t\tthis.answerContainer.innerHTML = \"\";\n\t\t\tthis.answerContainer.style.opacity = \"1\";\n\n\t\t\tswitch (this.lifes) {\n\t\t\t\tcase 3:\n\t\t\t\t\tthis.life1.classList.remove(\"loose\");\n\t\t\t\t\tthis.life2.classList.remove(\"loose\");\n\t\t\t\t\tthis.life3.classList.remove(\"loose\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tthis.life1.classList.remove(\"loose\");\n\t\t\t\t\tthis.life2.classList.remove(\"loose\");\n\t\t\t\t\tthis.life3.classList.add(\"loose\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tthis.life1.classList.remove(\"loose\");\n\t\t\t\t\tthis.life2.classList.add(\"loose\");\n\t\t\t\t\tthis.life3.classList.add(\"loose\");\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.guessFlag();\n\t\t\tlocalStorage.setItem(\"capitalnerdhard.lifes\", this.lifes);\n\t\t}\n\t\tthis.updateProgress();\n\t}\n\n\ttoDataURL(url, callback) {\n\t\tconst xhr = new XMLHttpRequest();\n\t\txhr.onload = () => {\n\t\t\tconst reader = new FileReader();\n\t\t\treader.onloadend = () => {\n\t\t\t\tcallback(reader.result);\n\t\t\t};\n\t\t\treader.readAsDataURL(xhr.response);\n\t\t};\n\t\txhr.open(\"GET\", url);\n\t\txhr.responseType = \"blob\";\n\t\txhr.send();\n\t}\n}\n","class CountryNerd {\n\tconstructor() {\n\t\tthis.currentLetter = \"a\";\n\t\tthis.countriesFound = 0;\n\t\tthis.loadCountries();\n\n\t\tthis.firstAnswer = document.querySelector(\".country-nerd .answers .answer\");\n\t\tthis.answers = document.querySelector(\".country-nerd .answers\");\n\t\tthis.answerContainer = document.querySelector(\".country-nerd .answer-container\");\n\t\tthis.answerInput = document.querySelector(\"#country-answer-input\");\n\t\tthis.answerButton = document.querySelector(\"#country-answer-validate\");\n\t\tthis.letters = document.querySelectorAll(\".country-nerd .letter\");\n\t\tthis.wonLink = document.querySelector(\".country-nerd .won-link\");\n\t\tthis.tipCurrent = document.querySelector(\".country-nerd .tip .found\");\n\t\tthis.tipTotal = document.querySelector(\".country-nerd .tip .total\");\n\n\t\tthis.buildLetters();\n\t\tthis.buildInputs();\n\t}\n\n\tbuildLetters() {\n\t\tconst letterPlaceholder = document.querySelector(\".letter-placeholder\");\n\t\tconst mainTitle = document.querySelector(\".country-nerd h1\");\n\t\tconst gameTitle = document.querySelector(\".game-title\");\n\t\tconst lettersContainer = document.querySelector(\".letters\");\n\n\t\tthis.letters.forEach(letter => {\n\t\t\tconst letterText = letter.innerHTML.toLowerCase();\n\t\t\tif (localStorage.getItem(\"countrynerd.letter.\" + letterText) === \"true\") {\n\t\t\t\tletter.classList.add(\"completed\");\n\t\t\t}\n\t\t\tletter.addEventListener(\"click\", () => {\n\t\t\t\tthis.currentLetter = letterText;\n\t\t\t\t// location.hash = \"#country-nerd-\" + letterText;\n\t\t\t\tlettersContainer.classList.add(\"hide\");\n\t\t\t\tgsap.to(mainTitle, {\n\t\t\t\t\topacity: 0,\n\t\t\t\t\tpointerEvents: \"none\",\n\t\t\t\t\tdelay: 0.2\n\t\t\t\t});\n\t\t\t\tgsap.to(gameTitle, {\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tdelay: 0.5\n\t\t\t\t});\n\t\t\t\tletterPlaceholder.innerHTML = letterText;\n\t\t\t\tthis.tipTotal.innerHTML = geoNerdApp.countriesByLetter[this.currentLetter].length;\n\t\t\t\tthis.firstAnswer.innerHTML = letterText;\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tlettersContainer.style.display = \"none\";\n\t\t\t\t\tthis.answerContainer.style.display = \"flex\";\n\t\t\t\t\tgsap.to(this.answerContainer, {\n\t\t\t\t\t\topacity: 1,\n\t\t\t\t\t\tdelay: 0.1\n\t\t\t\t\t});\n\t\t\t\t\tthis.answerInput.focus();\n\t\t\t\t}, 400);\n\t\t\t});\n\t\t});\n\t}\n\n\tloadCountries() {\n\n\t}\n\n\tbuildInputs() {\n\t\tthis.answerInput.addEventListener(\"change\", e => {\n\t\t\tthis.validateAnswer(e.target.value);\n\t\t});\n\t\tthis.answerButton.addEventListener(\"click\", e => {\n\t\t\tthis.validateAnswer(this.answerInput.value);\n\t\t});\n\t}\n\n\tvalidateAnswer(answer) {\n\t\tlet win = false;\n\t\tgeoNerdApp.countriesByLetter[this.currentLetter].forEach(country => {\n\t\t\tconst similarity = StringUtils.similarity(answer, country.sanitize);\n\t\t\tif (similarity > 0.85) {\n\t\t\t\t// if (answer === country.sanitize && !country.found) {\n\t\t\t\twin = true;\n\t\t\t\tthis.answerInput.value = \"\";\n\t\t\t\tcountry.found = true;\n\t\t\t\tconst rightAnswer = document.querySelector(\".answers .answer:first-child\");\n\t\t\t\trightAnswer.innerHTML = `${country.name}<span class=\"flag ${country.code}\"></span>`;\n\t\t\t\trightAnswer.classList.add(\"valid\");\n\t\t\t\tthis.countriesFound++;\n\t\t\t\tthis.tipCurrent.innerHTML = this.countriesFound;\n\t\t\t\tif (this.countriesFound === geoNerdApp.countriesByLetter[this.currentLetter].length) {\n\t\t\t\t\tthis.finished = true;\n\t\t\t\t}\n\t\t\t\tgsap.to(this.answerInput, {\n\t\t\t\t\tbackgroundColor: \"#25961c\",\n\t\t\t\t\tduration: 0.2,\n\t\t\t\t\tonComplete: () => {\n\t\t\t\t\t\tgsap.to(this.answerInput, {\n\t\t\t\t\t\t\tbackgroundColor: \"white\",\n\t\t\t\t\t\t\tduration: 0.2\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tif (win) {\n\t\t\tif (this.finished) {\n\t\t\t\tthis.wonLink.classList.add(\"show\");\n\t\t\t\tthis.answerContainer.classList.add(\"win\");\n\t\t\t\tlocalStorage.setItem(\"countrynerd.letter.\" + this.currentLetter, \"true\");\n\t\t\t} else {\n\t\t\t\tthis.answers.insertAdjacentHTML(\"afterbegin\", `<div class=\"answer\">${this.currentLetter}</div>`);\n\t\t\t}\n\t\t} else {\n\n\t\t\tgsap.to(this.answerInput, {\n\t\t\t\tbackgroundColor: \"#F05050\",\n\t\t\t\tduration: 0.2,\n\t\t\t\tonComplete: () => {\n\t\t\t\t\tgsap.to(this.answerInput, {\n\t\t\t\t\t\tbackgroundColor: \"white\",\n\t\t\t\t\t\tduration: 0.2\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.answerInput.value = \"\";\n\t\t}\n\t}\n}\n","class FlagNerdClassic {\n\tconstructor() {\n\t\tthis.flagContainer = document.querySelector(\".flag-nerd-classic .flag-container\");\n\t\tthis.answerContainer = document.querySelector(\".flag-nerd-classic .answer-container\");\n\t\tthis.winMessage = document.querySelector(\".flag-nerd-classic .win-message\");\n\t\tthis.looseMessage = document.querySelector(\".flag-nerd-classic .loose-message\");\n\t\tthis.lifes = parseInt(localStorage.getItem(\"flagnerd.lifes\")) || 3;\n\t\tthis.life3 = document.querySelector(\".flag-nerd-classic .heart-3\");\n\t\tthis.life2 = document.querySelector(\".flag-nerd-classic .heart-2\");\n\t\tthis.life1 = document.querySelector(\".flag-nerd-classic .heart-1\");\n\t\tthis.countriesLeft = JSON.parse(localStorage.getItem(\"flagnerd.countriesleft\"));\n\t\tif (this.countriesLeft) {\n\t\t\tif (this.countriesLeft.length === 0) {\n\t\t\t\tthis.winMessage.classList.add(\"show\");\n\t\t\t\tthis.updateProgress();\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.countriesLeft = [];\n\t\t\tgeoNerdApp.countries.forEach(country => {\n\t\t\t\tthis.countriesLeft.push(country);\n\t\t\t});\n\t\t}\n\t\tthis.updateStorage();\n\t\tthis.updateLife();\n\t}\n\n\tguessFlag() {\n\t\tthis.updateStorage();\n\t\tthis.updateProgress();\n\t\tif (this.countriesLeft.length === 0) {\n\t\t\tthis.winMessage.classList.add(\"show\");\n\t\t\tlocalStorage.setItem(\"flagnerd.best\", geoNerdApp.countries.length.toString());\n\t\t} else {\n\t\t\tthis.rightAnswer = this.countriesLeft[Math.floor(Math.random() * this.countriesLeft.length)];\n\t\t\tconst proposals = [];\n\t\t\tgeoNerdApp.countries.forEach(country => {\n\t\t\t\tif (country.code === this.rightAnswer.code) {\n\t\t\t\t\tproposals.push({\"code\": country.code, \"name\": country.name});\n\t\t\t\t\tthis.toDataURL(`/img/flags/${country.code}.svg`, (dataUrl) => {\n\t\t\t\t\t\tthis.flagContainer.insertAdjacentHTML(\"afterbegin\", `<div class=\"flag\" style=\"background-image: url(${dataUrl})\"></div>`);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst maxLength = this.countriesLeft.length < 4 ? this.countriesLeft.length : 4;\n\t\t\twhile (proposals.length < maxLength) {\n\t\t\t\tconst proposal = this.countriesLeft[Math.floor(Math.random() * this.countriesLeft.length)];\n\t\t\t\tif (proposal.code !== this.rightAnswer.code) {\n\t\t\t\t\tlet duplicate = false;\n\t\t\t\t\tfor (let prop of proposals) {\n\t\t\t\t\t\tif (prop.code === proposal.code) {\n\t\t\t\t\t\t\tduplicate = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!duplicate) {\n\t\t\t\t\t\tproposals.push({\"code\": proposal.code, \"name\": proposal.name});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.shuffle(proposals);\n\t\t\tproposals.forEach(proposal => {\n\t\t\t\tthis.answerContainer.insertAdjacentHTML(\"beforeend\", `<div class=\"country\" data-country-code=\"${proposal.code}\">${proposal.name}</div>`);\n\t\t\t});\n\t\t\tthis.guess();\n\t\t}\n\t}\n\n\tshuffle(array) {\n\t\tlet currentIndex = array.length, randomIndex;\n\t\twhile (currentIndex !== 0) {\n\t\t\trandomIndex = Math.floor(Math.random() * currentIndex);\n\t\t\tcurrentIndex--;\n\t\t\t[array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];\n\t\t}\n\t\treturn array;\n\t}\n\n\tguess() {\n\t\tthis.answerContainer.style.pointerEvents = \"initial\";\n\t\tdocument.querySelectorAll(\".flag-nerd-classic .country\").forEach(guess => {\n\t\t\tguess.addEventListener(\"click\", () => {\n\t\t\t\tlet decreaseLife = false;\n\t\t\t\tif (guess.dataset.countryCode === this.rightAnswer.code) {\n\t\t\t\t\tguess.classList.add(\"valid\");\n\t\t\t\t\tthis.countriesLeft = this.countriesLeft.filter(elem => elem.code !== this.rightAnswer.code);\n\t\t\t\t\tthis.updateStorage();\n\t\t\t\t} else {\n\t\t\t\t\tdocument.querySelector(`[data-country-code=\"${this.rightAnswer.code}\"]`).classList.add(\"valid\");\n\t\t\t\t\tguess.classList.add(\"invalid\");\n\t\t\t\t\tdecreaseLife = true;\n\t\t\t\t}\n\t\t\t\tthis.answerContainer.style.pointerEvents = \"none\";\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tgsap.to(this.flagContainer, {\n\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t});\n\t\t\t\t\tgsap.to(this.answerContainer, {\n\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t\tonComplete: () => {\n\t\t\t\t\t\t\tthis.updateLife(decreaseLife);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}, 700);\n\t\t\t});\n\t\t});\n\t}\n\n\tupdateStorage() {\n\t\tlocalStorage.setItem(\"flagnerd.countriesleft\", JSON.stringify(this.countriesLeft));\n\t}\n\n\tupdateProgress() {\n\t\tdocument.querySelector(\".flag-nerd-classic .progress .found\").innerHTML = (geoNerdApp.countries.length - this.countriesLeft.length).toString();\n\t\tdocument.querySelector(\".flag-nerd-classic .progress .best .value\").innerHTML = localStorage.getItem(\"flagnerd.best\") || 0;\n\t}\n\n\tupdateLife(decrease) {\n\t\tif (decrease) {\n\t\t\tthis.lifes--;\n\t\t}\n\t\tif (this.lifes === 0) {\n\t\t\tthis.life1.classList.add(\"loose\");\n\t\t\tthis.life2.classList.add(\"loose\");\n\t\t\tthis.life3.classList.add(\"loose\");\n\t\t\tlocalStorage.removeItem(\"flagnerd.countriesleft\");\n\t\t\tlocalStorage.removeItem(\"flagnerd.lifes\");\n\t\t\tconst currentBest = localStorage.getItem(\"flagnerd.best\") || 0;\n\t\t\tconst currentScore = geoNerdApp.countries.length - this.countriesLeft.length;\n\t\t\tif (currentScore > currentBest) {\n\t\t\t\tlocalStorage.setItem(\"flagnerd.best\", currentScore.toString());\n\t\t\t}\n\t\t\tgsap.to(this.flagContainer, {\n\t\t\t\topacity: 0,\n\t\t\t});\n\t\t\tgsap.to(this.answerContainer, {\n\t\t\t\topacity: 0,\n\t\t\t\tonComplete: () => {\n\t\t\t\t\tthis.looseMessage.classList.add(\"show\");\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\n\t\t\tthis.flagContainer.innerHTML = \"\";\n\t\t\tthis.flagContainer.style.opacity = \"1\";\n\n\t\t\tthis.answerContainer.innerHTML = \"\";\n\t\t\tthis.answerContainer.style.opacity = \"1\";\n\n\t\t\tswitch (this.lifes) {\n\t\t\t\tcase 3:\n\t\t\t\t\tthis.life1.classList.remove(\"loose\");\n\t\t\t\t\tthis.life2.classList.remove(\"loose\");\n\t\t\t\t\tthis.life3.classList.remove(\"loose\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tthis.life1.classList.remove(\"loose\");\n\t\t\t\t\tthis.life2.classList.remove(\"loose\");\n\t\t\t\t\tthis.life3.classList.add(\"loose\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tthis.life1.classList.remove(\"loose\");\n\t\t\t\t\tthis.life2.classList.add(\"loose\");\n\t\t\t\t\tthis.life3.classList.add(\"loose\");\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.guessFlag();\n\t\t\tlocalStorage.setItem(\"flagnerd.lifes\", this.lifes);\n\t\t}\n\t\tthis.updateProgress();\n\t}\n\n\ttoDataURL(url, callback) {\n\t\tconst xhr = new XMLHttpRequest();\n\t\txhr.onload = () => {\n\t\t\tconst reader = new FileReader();\n\t\t\treader.onloadend = () => {\n\t\t\t\tcallback(reader.result);\n\t\t\t};\n\t\t\treader.readAsDataURL(xhr.response);\n\t\t};\n\t\txhr.open(\"GET\", url);\n\t\txhr.responseType = \"blob\";\n\t\txhr.send();\n\t}\n}\n","class FlagNerdHard {\n\tconstructor() {\n\t\tthis.flagContainer = document.querySelector(\".flag-nerd-hard .flag-container\");\n\t\tthis.answerContainer = document.querySelector(\".flag-nerd-hard .answer-container\");\n\t\tthis.answerInput = this.answerContainer.querySelector(\".answer-input\");\n\t\tthis.answerButton = this.answerContainer.querySelector(\".validate-input\");\n\t\tthis.winMessage = document.querySelector(\".flag-nerd-hard .win-message\");\n\t\tthis.looseMessage = document.querySelector(\".flag-nerd-hard .loose-message\");\n\t\tthis.lifes = parseInt(localStorage.getItem(\"flagnerdhard.lifes\")) || 3;\n\t\tthis.life3 = document.querySelector(\".flag-nerd-hard .heart-3\");\n\t\tthis.life2 = document.querySelector(\".flag-nerd-hard .heart-2\");\n\t\tthis.life1 = document.querySelector(\".flag-nerd-hard .heart-1\");\n\t\tthis.countriesLeft = JSON.parse(localStorage.getItem(\"flagnerdhard.countriesleft\"));\n\t\tif (this.countriesLeft) {\n\t\t\tif (this.countriesLeft.length === 0) {\n\t\t\t\tthis.winMessage.classList.add(\"show\");\n\t\t\t\tthis.updateProgress();\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.countriesLeft = [];\n\t\t\tgeoNerdApp.countries.forEach(country => {\n\t\t\t\tthis.countriesLeft.push(country);\n\t\t\t});\n\t\t}\n\t\tthis.updateStorage();\n\t\tthis.updateLife();\n\t\tthis.buildEvents();\n\t}\n\n\tguessFlag() {\n\t\tthis.updateStorage();\n\t\tthis.updateProgress();\n\t\tif (this.countriesLeft.length === 0) {\n\t\t\tthis.winMessage.classList.add(\"show\");\n\t\t\tlocalStorage.setItem(\"flagnerdhard.best\", geoNerdApp.countries.length.toString());\n\t\t} else {\n\t\t\tthis.rightAnswer = this.countriesLeft[Math.floor(Math.random() * this.countriesLeft.length)];\n\t\t\tthis.toDataURL(`/img/flags/${this.rightAnswer.code}.svg`, (dataUrl) => {\n\t\t\t\tthis.flagContainer.innerHTML = \"\";\n\t\t\t\tthis.flagContainer.insertAdjacentHTML(\"afterbegin\", `<div class=\"flag\" style=\"background-image: url(${dataUrl})\"></div>`);\n\t\t\t\tthis.answerInput.focus();\n\t\t\t});\n\t\t}\n\t}\n\n\n\tbuildEvents() {\n\t\tthis.answerInput.addEventListener(\"change\", e => {\n\t\t\tthis.validateAnswer(e.target.value);\n\t\t});\n\t\t// this.answerButton.addEventListener(\"click\", e => {\n\t\t// \tthis.validateAnswer(this.answerInput.value);\n\t\t// });\n\t}\n\n\tvalidateAnswer(answer) {\n\t\tlet decreaseLife = false;\n\t\tlet found = false;\n\t\tthis.countriesLeft.forEach(country => {\n\t\t\tconst similarity = StringUtils.similarity(answer, country.sanitize);\n\t\t\tif (similarity > 0.85 && country.code === this.rightAnswer.code) {\n\t\t\t\tfound = true;\n\t\t\t}\n\t\t});\n\t\tif (found) {\n\t\t\tthis.countriesLeft = this.countriesLeft.filter(elem => elem.code !== this.rightAnswer.code);\n\t\t\tthis.updateStorage();\n\t\t\tgsap.to(this.answerInput, {\n\t\t\t\tbackgroundColor: \"#33ce29\",\n\t\t\t\tcolor: \"white\",\n\t\t\t\tduration: 0.3,\n\t\t\t\tonComplete: () => {\n\t\t\t\t\tgsap.set(this.answerInput, {\n\t\t\t\t\t\tbackgroundColor: \"white\",\n\t\t\t\t\t\tcolor: \"black\",\n\t\t\t\t\t\tdelay: 0.8\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tdecreaseLife = true;\n\t\t\tgsap.to(this.answerInput, {\n\t\t\t\tbackgroundColor: \"#F05050\",\n\t\t\t\tcolor: \"white\",\n\t\t\t\tduration: 0.3,\n\t\t\t\tonComplete: () => {\n\t\t\t\t\tgsap.set(this.answerInput, {\n\t\t\t\t\t\tbackgroundColor: \"white\",\n\t\t\t\t\t\tcolor: \"black\",\n\t\t\t\t\t\tdelay: 0.8\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tsetTimeout(() => {\n\t\t\tgsap.to(this.flagContainer, {\n\t\t\t\topacity: 0,\n\t\t\t});\n\t\t\tgsap.to(this.answerContainer, {\n\t\t\t\topacity: 0,\n\t\t\t\tonComplete: () => {\n\t\t\t\t\tthis.answerInput.value = \"\";\n\t\t\t\t\tthis.updateLife(decreaseLife);\n\t\t\t\t}\n\t\t\t});\n\t\t}, 700);\n\t}\n\n\tupdateStorage() {\n\t\tlocalStorage.setItem(\"flagnerdhard.countriesleft\", JSON.stringify(this.countriesLeft));\n\t}\n\n\tupdateProgress() {\n\t\tdocument.querySelector(\".flag-nerd-hard .progress .found\").innerHTML = (geoNerdApp.countries.length - this.countriesLeft.length).toString();\n\t\tdocument.querySelector(\".flag-nerd-hard .progress .best .value\").innerHTML = localStorage.getItem(\"flagnerdhard.best\") || 0;\n\t}\n\n\tupdateLife(decrease) {\n\t\tif (decrease) {\n\t\t\tthis.lifes--;\n\t\t}\n\t\tif (this.lifes === 0) {\n\t\t\tthis.life1.classList.add(\"loose\");\n\t\t\tthis.life2.classList.add(\"loose\");\n\t\t\tthis.life3.classList.add(\"loose\");\n\t\t\tlocalStorage.removeItem(\"flagnerdhard.countriesleft\");\n\t\t\tlocalStorage.removeItem(\"flagnerdhard.lifes\");\n\t\t\tconst currentBest = localStorage.getItem(\"flagnerdhard.best\") || 0;\n\t\t\tconst currentScore = geoNerdApp.countries.length - this.countriesLeft.length;\n\t\t\tif (currentScore > currentBest) {\n\t\t\t\tlocalStorage.setItem(\"flagnerdhard.best\", currentScore.toString());\n\t\t\t}\n\t\t\tgsap.to(this.flagContainer, {\n\t\t\t\topacity: 0,\n\t\t\t});\n\t\t\tgsap.to(this.answerContainer, {\n\t\t\t\topacity: 0,\n\t\t\t\tonComplete: () => {\n\t\t\t\t\tthis.looseMessage.classList.add(\"show\");\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.flagContainer.innerHTML = \"\";\n\t\t\tthis.flagContainer.style.opacity = \"1\";\n\n\t\t\t// this.answerContainer.innerHTML = \"\";\n\t\t\tthis.answerContainer.style.opacity = \"1\";\n\n\t\t\tswitch (this.lifes) {\n\t\t\t\tcase 3:\n\t\t\t\t\tthis.life1.classList.remove(\"loose\");\n\t\t\t\t\tthis.life2.classList.remove(\"loose\");\n\t\t\t\t\tthis.life3.classList.remove(\"loose\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tthis.life1.classList.remove(\"loose\");\n\t\t\t\t\tthis.life2.classList.remove(\"loose\");\n\t\t\t\t\tthis.life3.classList.add(\"loose\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tthis.life1.classList.remove(\"loose\");\n\t\t\t\t\tthis.life2.classList.add(\"loose\");\n\t\t\t\t\tthis.life3.classList.add(\"loose\");\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.guessFlag();\n\t\t\tlocalStorage.setItem(\"flagnerdhard.lifes\", this.lifes);\n\t\t}\n\t\tthis.updateProgress();\n\t}\n\n\ttoDataURL(url, callback) {\n\t\tconst xhr = new XMLHttpRequest();\n\t\txhr.onload = () => {\n\t\t\tconst reader = new FileReader();\n\t\t\treader.onloadend = () => {\n\t\t\t\tcallback(reader.result);\n\t\t\t};\n\t\t\treader.readAsDataURL(xhr.response);\n\t\t};\n\t\txhr.open(\"GET\", url);\n\t\txhr.responseType = \"blob\";\n\t\txhr.send();\n\t}\n}\n","class GeoNerdNavigation {\n\tconstructor() {\n\t\tthis.pages = document.querySelectorAll(\".pages .page\");\n\n\t\tthis.changePage();\n\n\t\twindow.addEventListener(\"hashchange\", e => {\n\t\t\tthis.changePage();\n\t\t});\n\n\t\tdocument.querySelectorAll(\".reload\").forEach(elem => {\n\t\t\telem.addEventListener(\"click\", ()=>{\n\t\t\t\tlocalStorage.removeItem(\"flagnerd.countriesleft\");\n\t\t\t\twindow.location.reload();\n\t\t\t});\n\t\t});\n\t}\n\n\tchangePage() {\n\t\tlet navTo = location.hash;\n\t\tif (!navTo){\n\t\t\tnavTo = \"#home\";\n\t\t}\n\t\tconst nextPage = document.querySelector(navTo);\n\t\tif (nextPage) {\n\t\t\tthis.pages.forEach(page => {\n\t\t\t\tpage.classList.remove(\"active\");\n\t\t\t});\n\t\t\tnextPage.classList.add(\"active\");\n\t\t}\n\t}\n}\n","class Settings {\n\tconstructor() {\n\t\tthis.settingPage = document.querySelector(\".page.settings\");\n\t\tthis.clearCountryNerd();\n\t\tthis.clearFlagNerdClassic();\n\t\tthis.clearFlagNerdHard();\n\t\tthis.clearCapitalNerdClassic();\n\t\tthis.clearCapitalNerdHard();\n\t}\n\n\tclearCountryNerd() {\n\t\tthis.settingPage.querySelector(\".clear-country-nerd\").addEventListener(\"click\", e => {\n\t\t\tgeoNerdApp.letters.forEach(letter => {\n\t\t\t\tlocalStorage.removeItem(\"countrynerd.letter.\" + letter);\n\t\t\t});\n\t\t\te.target.classList.add(\"done\");\n\t\t});\n\t}\n\n\tclearFlagNerdClassic() {\n\t\tthis.settingPage.querySelector(\".clear-flag-nerd-classic\").addEventListener(\"click\", e => {\n\t\t\tlocalStorage.removeItem(\"flagnerd.countriesleft\");\n\t\t\tlocalStorage.removeItem(\"flagnerd.best\");\n\t\t\tlocalStorage.removeItem(\"flagnerd.lifes\");\n\t\t\te.target.classList.add(\"done\");\n\t\t});\n\t}\n\n\tclearFlagNerdHard() {\n\t\tthis.settingPage.querySelector(\".clear-flag-nerd-hard\").addEventListener(\"click\", e => {\n\t\t\tlocalStorage.removeItem(\"flagnerdhard.countriesleft\");\n\t\t\tlocalStorage.removeItem(\"flagnerdhard.best\");\n\t\t\tlocalStorage.removeItem(\"flagnerdhard.lifes\");\n\t\t\te.target.classList.add(\"done\");\n\t\t});\n\t}\n\n\tclearCapitalNerdClassic() {\n\t\tthis.settingPage.querySelector(\".clear-capital-nerd-classic\").addEventListener(\"click\", e => {\n\t\t\tlocalStorage.removeItem(\"capitalnerd.countriesleft\");\n\t\t\tlocalStorage.removeItem(\"capitalnerd.best\");\n\t\t\tlocalStorage.removeItem(\"capitalnerd.lifes\");\n\t\t\te.target.classList.add(\"done\");\n\t\t});\n\t}\n\n\tclearCapitalNerdHard() {\n\t\tthis.settingPage.querySelector(\".clear-capital-nerd-hard\").addEventListener(\"click\", e => {\n\t\t\tlocalStorage.removeItem(\"capitalnerdhard.countriesleft\");\n\t\t\tlocalStorage.removeItem(\"capitalnerdhard.best\");\n\t\t\tlocalStorage.removeItem(\"capitalnerdhard.lifes\");\n\t\t\te.target.classList.add(\"done\");\n\t\t});\n\t}\n}\n","class StringUtils {\n\tstatic similarity(a, b) {\n\t\ta = this.sanitize(a);\n\t\ta = this.prep(a);\n\t\tb = this.prep(b);\n\t\tconst bg1 = this.bigrams(a);\n\t\tconst bg2 = this.bigrams(b);\n\t\tconst c1 = this.count(bg1);\n\t\tconst c2 = this.count(bg2);\n\t\tconst combined = this.uniq([...bg1, ...bg2])\n\t\t\t.reduce((t, k) => t + (Math.min(c1 [k] || 0, c2 [k] || 0)), 0);\n\t\treturn 2 * combined / (bg1.length + bg2.length);\n\t}\n\n\tstatic prep(str) {\n\t\treturn str.toLowerCase().replace(/[^\\w\\s]/g, ' ').replace(/\\s+/g, ' ');\n\t}\n\n\tstatic bigrams(str) {\n\t\treturn [...str].slice(0, -1).map((c, i) => c + str [i + 1]);\n\t}\n\n\tstatic count(xs) {\n\t\treturn xs.reduce(function(a, x) {\n\t\t\ta [x] = (a [x] || 0) + 1;\n\t\t\treturn a;\n\t\t\t}, {});\n\t}\n\n\tstatic uniq(xs) {\n\t\treturn [...new Set(xs)];\n\t}\n\n\tstatic sanitize(value) {\n\t\treturn value.toLowerCase().normalize(\"NFD\")\n\t\t\t.replace(/[\\u0300-\\u036f]/g, \"\")\n\t\t\t.replace(/-/g, \"\")\n\t\t\t.replace(/'/g, \"\")\n\t\t\t.replace(/ /g, \"\")\n\t\t\t.replace(/â€™/g, \"\");\n\t}\n}\n"]}